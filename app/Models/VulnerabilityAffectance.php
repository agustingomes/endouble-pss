<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use App\Libs\Helpers\Versions;

/**
 * Vulnerability Affectance model.
 *
 * Defines a product and a range of versions that are affected by the related vulnerability.
 * Min property indicates the minimal affected version.
 * Fixed In property indicated the version where the issue was fixed (if any).
 */
class VulnerabilityAffectance extends Model
{
    /**
     * The attributes that are mass assignable.
     *
     * @var array
     */
    protected $fillable = ['product_id', 'vulnerability_id', 'min', 'fixed_in'];

    /**
     * Indicates if the model should be timestamped.
     *
     * @var bool
     */
    public $timestamps = false;

    /**
     * Checks if the vulnerability version affects a particular version.
     *
     * @param  string $version
     * @return bool
     */
    public function affects($version)
    {
        $version = Versions::removeVSigns($version);

        return version_compare($version, $this->min, '>=') && version_compare($version, $this->fixed_in, '<');
    }

    /**
     * Product relation.
     *
     * @return \Illuminate\Database\Eloquent\Relations\belongsTo
     */
    public function product()
    {
        return $this->belongsTo('App\Models\Product');
    }

    /**
     * Vulnerability relation.
     *
     * @return \Illuminate\Database\Eloquent\Relations\belongsTo
     */
    public function vulnerability()
    {
        return $this->belongsTo('App\Models\Vulnerability');
    }
}
